/*
THIS IS A BASIC MAKE FILE THAT WILL BE FURTHER DEVELOPED IN THE FUTURE
*/

// con cmd
task compileCmake {
	dependsOn { tasks.findAll { task -> task.name.startsWith('cmake')}}
}

// con native tools
task compileLib {
	dependsOn { tasks.findAll { task -> task.name.startsWith('cmp')}}
}

/*
##### OGRE
*/
 // CREATE FOLDER WHERE LIB WILL BE COMPILED
task cmakeOgreFolder {
	mkdir("../Dependencies/ogre-1.11.5/Build")
}

// CALL CMAKE TO COMPILE OGRE LIB
task cmakeOgre (type: Exec) {
	executable = '"../CMake/bin/cmake.exe"'
	args = ['-S"../Dependencies/ogre-1.11.5"', '-B"../Dependencies/ogre-1.11.5/Build"']
}

// ORDER
cmakeOgre.mustRunAfter cmakeOgreFolder

/*
##### OIS
*/
 // CREATE FOLDER WHERE LIB WILL BE COMPILED
task cmakeOISFolder () {
	mkdir("../Dependencies/OIS-master/Build")
}

// CALL CMAKE TO COMPILE OIS LIB
task cmakeOIS (type: Exec) {
	executable = '"../CMake/bin/cmake.exe"'
	args = ['-S"../Dependencies/OIS-master"', '-B"../Dependencies/OIS-master/Build"']
}

// ORDER
cmakeOIS.mustRunAfter cmakeOISFolder

/*
##### OGRE
*/
// COMPILE IN VISUAL RELEASE/DEBUG
task cmpOgreVS_r (type: Exec) {
	commandLine 'msbuild', '"../Dependencies/ogre-1.11.5/Build/OGRE.sln"', '/t:build', '/p:Configuration=Release', '/p:Platform="Win32"'
}
task cmpOgreVS_d (type: Exec) {
	commandLine 'msbuild', '"../Dependencies/ogre-1.11.5/Build/OGRE.sln"', '/t:build', '/p:Configuration=Debug', '/p:Platform="Win32"'
}

// COPY OGRE DLLS RELEASE/DEBUG INTO FOLDER
task cmpOgreDll_r (type: Copy) {
	from file("../Dependencies/ogre-1.11.5/Build/bin/release/OgreMain.dll"), file("../Dependencies/ogre-1.11.5/Build/bin/release/zlib.dll")
    into "../Exes/"
}
task cmpOgreDll_d (type: Copy) {
	from file("../Dependencies/ogre-1.11.5/Build/bin/debug/OgreMain_d.dll")
    into file("../Exes/")
}

// COPY GL DLLS RELEASE/DEBUG INTO FOLDER
task cmpOgreGl_r(type: Copy) {
	from file("../Dependencies/ogre-1.11.5/Build/bin/release/RenderSystem_GL.dll"), file("../Dependencies/ogre-1.11.5/Build/bin/release/Codec_STBI.dll")
	into file("../Exes/Ogre/Ogre/")
}
task cmpOgreGl_d(type: Copy) {
	from file("../Dependencies/ogre-1.11.5/Build/bin/debug/RenderSystem_GL_d.dll"), file("../Dependencies/ogre-1.11.5/Build/bin/debug/Codec_STBI_d.dll")
	into file("../Exes/OgreD/OgreD/")
}

// ORDER OF COMPILING
cmpOgreGl_r.mustRunAfter cmpOgreDll_r
cmpOgreGl_d.mustRunAfter cmpOgreDll_d
cmpOgreDll_r.mustRunAfter cmpOgreVS_r
cmpOgreDll_d.mustRunAfter cmpOgreVS_d


/*
##### PHYSX
*/
// COPY DLLS INTO FOLDER
task cmpPhysxDll (type: Copy) {
	from file("../Dependencies/physx/bin/win.x86_32.vc141.md/debug/PhysX_32.dll"), file("../Dependencies/physx/bin/win.x86_32.vc141.md/debug/PhysXCommon_32.dll"), file("../Dependencies/physx/bin/win.x86_32.vc141.md/debug/PhysXCooking_32.dll"), file("../Dependencies/physx/bin/win.x86_32.vc141.md/debug/PhysXFoundation_32.dll")
	into file("../Exes/")
}

/*
##### OIS
*/
// COPY OIS DLLS RELEASE INTO FOLDER
task cmpOISVS_r (type: Exec) {
	commandLine 'msbuild', '"../Dependencies/OIS-master/Build/OIS.sln"', '/t:build', '/p:Configuration=Release', '/p:Platform="Win32"'
}
task cmpOISVS_d (type: Exec) {
	commandLine 'msbuild', '"../Dependencies/OIS-master/Build/OIS.sln"', '/t:build', '/p:Configuration=Debug', '/p:Platform="Win32"'
}

// COPY GL DLLS RELEASE/DEBUG INTO FOLDER
task cmpOIsDlls_r (type: Copy) {
	from '../Dependencies/OIS-master/Build/Release/OIS.dll'
	into "../Exes/"
}
task cmpOIsDlls_d (type: Copy) {
	from '../Dependencies/OIS-master/Build/Release/OIS_d.dll'
	into "../Exes/"
}
// ORDER OF COMPILING
cmpOIsDlls_r.mustRunAfter cmpOISVS_r
cmpOIsDlls_d.mustRunAfter cmpOISVS_d